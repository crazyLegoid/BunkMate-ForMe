<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>BunkMate</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}

header {
  background: #020617;
  padding: 16px;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
}

main {
  padding: 16px;
  max-width: 480px;
  margin: auto;
}

form {
  background: #020617;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 20px;
}

label {
  font-size: 14px;
  display: block;
  margin-top: 10px;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 4px;
  border-radius: 8px;
  border: none;
  background: #1e293b;
  color: #fff;
}

button {
  margin-top: 12px;
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 10px;
  background: #2563eb;
  color: #fff;
  font-weight: 600;
}

.subject {
  background: #020617;
  padding: 16px;
  border-radius: 14px;
  margin-bottom: 14px;
}

.subject.safe { border-left: 6px solid #16a34a; }
.subject.warn { border-left: 6px solid #eab308; }
.subject.danger { border-left: 6px solid #dc2626; }

.progress-bg {
  background: #334155;
  height: 8px;
  border-radius: 4px;
  margin: 10px 0;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  transition: width 0.3s ease;
}

.actions {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.actions button {
  background: #334155;
  font-size: 14px;
}

.empty {
  text-align: center;
  opacity: 0.6;
  margin-top: 40px;
}
</style>
</head>

<body>
<header>BunkMate</header>

<main>
<form id="subjectForm">
  <label>Subject Name
    <input id="name" required>
  </label>
  <label>Classes Attended
    <input id="attended" type="number" min="0" required>
  </label>
  <label>Total Classes
    <input id="total" type="number" min="0" required>
  </label>
  <label>Minimum Attendance %
    <input id="minimum" type="number" min="1" max="100" placeholder="75">
  </label>
  <button>Add Subject</button>
</form>

<div id="subjects"></div>
<div id="empty" class="empty">No subjects yet</div>
</main>

<script>
const STORAGE_KEY = "bunkmate-db";

const nameInput = document.getElementById("name");
const attendedInput = document.getElementById("attended");
const totalInput = document.getElementById("total");
const minimumInput = document.getElementById("minimum");
const subjectsDiv = document.getElementById("subjects");
const emptyDiv = document.getElementById("empty");

function loadDB() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
    settings: { defaultMinimumAttendance: 75 },
    subjects: []
  };
}

function saveDB(db) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
}

function attendancePercent(a, t) {
  return t === 0 ? 100 : (a / t) * 100;
}

function status(p, m) {
  if (p < m) return "danger";
  if (p <= m + 5) return "warn";
  return "safe";
}

function render() {
  const db = loadDB();
  subjectsDiv.innerHTML = "";

  emptyDiv.style.display = db.subjects.length ? "none" : "block";

  db.subjects.forEach(s => {
    const p = attendancePercent(s.attended, s.total);
    const color = p < s.minimumAttendance ? "#dc2626" :
                  p <= s.minimumAttendance + 5 ? "#eab308" : "#16a34a";

    const div = document.createElement("div");
    div.className = `subject ${status(p, s.minimumAttendance)}`;
    div.innerHTML = `
      <h3>${s.name}</h3>
      <div>${s.attended} / ${s.total} classes</div>

      <div class="progress-bg">
        <div class="progress-fill" style="width:${Math.min(p,100)}%;background:${color}"></div>
      </div>

      <div>${p.toFixed(2)}%</div>

      <div class="actions">
        <button data-action="attend" data-id="${s.id}">+ Attend</button>
        <button data-action="bunk" data-id="${s.id}">+ Bunk</button>
        <button data-action="delete" data-id="${s.id}">Delete</button>
      </div>
    `;
    subjectsDiv.appendChild(div);
  });
}

document.getElementById("subjectForm").addEventListener("submit", e => {
  e.preventDefault();
  const db = loadDB();

  const name = nameInput.value.trim();
  const attended = Number(attendedInput.value);
  const total = Number(totalInput.value);
  const min = Number(minimumInput.value) || db.settings.defaultMinimumAttendance;

  if (!name || attended < 0 || total < attended) {
    alert("Invalid input");
    return;
  }

  db.subjects.push({
    id: crypto.randomUUID(),
    name,
    attended,
    total,
    minimumAttendance: min
  });

  saveDB(db);
  e.target.reset();
  render();
});

subjectsDiv.addEventListener("click", e => {
  const btn = e.target.closest("button");
  if (!btn) return;

  const id = btn.dataset.id;
  const action = btn.dataset.action;
  const db = loadDB();
  const s = db.subjects.find(x => x.id === id);
  if (!s) return;

  if (action === "attend") {
    s.attended++;
    s.total++;
  } else if (action === "bunk") {
    s.total++;
  } else if (action === "delete") {
    db.subjects = db.subjects.filter(x => x.id !== id);
  }

  saveDB(db);
  render();
});

render();
</script>
</body>
</html>